[![lint nordlynx proxy dockerfile](https://github.com/edgd1er/nordlynx-proxy/actions/workflows/lint.yml/badge.svg?branch=main)](https://github.com/edgd1er/nordvpn-proxy/actions/workflows/lint.yml)

[![build nordlynx proxy multi-arch images](https://github.com/edgd1er/nordlynx-proxy/actions/workflows/buildPush.yml/badge.svg?branch=main)](https://github.com/edgd1er/nordvpn-proxy/actions/workflows/buildPush.yml)

![Docker Size](https://badgen.net/docker/size/edgd1er/nordlynx-proxy?icon=docker&label=Size)
![Docker Pulls](https://badgen.net/docker/pulls/edgd1er/nordlynx-proxy?icon=docker&label=Pulls)
![Docker Stars](https://badgen.net/docker/stars/edgd1er/nordlynx-proxy?icon=docker&label=Stars)
![ImageLayers](https://badgen.net/docker/layers/edgd1er/nordlynx-proxy?icon=docker&label=Layers)

![Docker Size](https://badgen.net/docker/size/edgd1er/nordlynx-proxy-wg?icon=docker&label=Size)
![Docker Pulls](https://badgen.net/docker/pulls/edgd1er/nordlynx-proxy-wg?icon=docker&label=Pulls)
![Docker Stars](https://badgen.net/docker/stars/edgd1er/nordlynx-proxy-wg?icon=docker&label=Stars)
![ImageLayers](https://badgen.net/docker/layers/edgd1er/nordlynx-proxy-wg?icon=docker&label=Layers)

# nordlynx-proxy

[NordVPN client's version](https://nordvpn.com/fr/blog/nordvpn-linux-release-notes/) or [changelog](https://repo.nordvpn.com/deb/nordvpn/debian/pool/main/nordvpn_3.16.1_amd64.changelog): 3.16.1 (23/03/24)

Warning 1: login process is sometimes unstable: 
```
It's not you, it's us. We're having trouble reaching our servers. If the issue persists, please contact our customer support.
```

Warning 2: login through token is preferred:
```
Logging in via ‘--legacy’, ‘--username’, and ‘--password’ flags is deprecated. Use ‘nordvpn login' or ‘nordvpn login --nordaccount’ to log in via browser. Alternatively, you can use ‘nordvpn login --token’ to log in with a generated token.
```

Warning 3: At the moment, the container is not set to run with generated wireguard config file. (healthcheck, start checks, switch from NordVPN to WireGuard tools) 


### Description
This is a NordVPN docker container that connects to the NordVPN recommended servers using the NordVPN Linux client. It starts a SOCKS5 proxy server (dante) and a HTTP proxy server to use it as a NordVPN gateway. After this operation, 317 MB of additional disk space will be used. (nordlynx-proxy-wg image is built to compare sizes). OpenVPN and NordLynx technology are available through NordVPN settings technology. Whenever the connection is lost, the NordVPN client has a killswitch to obliterate the connection.

### Exporting WireGuard config
If environment variable `GENERATE_WIREGUARD_CONF=true` is set, the WireGuard configuration is saved to `/etc/wireguard/wg0.conf when connecting.
This file can be exported then re-used to setup a plain WireGuard connection. 


Added docker image version for raspberry.  




### VPN tests:
* https://www.dnsleaktest.com
* https://ipleak.net/
* https://browserleaks.com/webrtc

**Please note that WebRTC will leak your real IP. You need to disable WebRTC  or install nordvpn's browser extension.**
https://browserleaks.com/webrtc#howto-disable-webrtc

## What is this?

This image is a variation of nordvpn-proxy. The latter is based on openvpn. 
The nordvpn application replace openvpn. Nordvpn version of [wireguard](https://nordvpn.com/blog/wireguard-simplicity-efficiency/) is [nordlynx](https://nordvpn.com/blog/nordlynx-protocol-wireguard/).

you can then expose port `1080` from the container to access the VPN connection via the SOCKS5 proxy, or use the `8888` http's proxy port.

To sum up, this container:
* Opens the best connection to NordVPN using nordvpn app NordVpn API results according to your criteria.
* Starts a HTTP proxy that route `eth0:8888` to `eth0:1080` (socks server) with [tinyproxy](https://tinyproxy.github.io/)
* Starts a SOCKS5 proxy that routes `eth0:1080` to `tun0/nordlynx` with [dante-server](https://www.inet.no/dante/).
* nordvpn dns servers perform resolution, by default.
* uses supervisor to handle easily services.

The main advantages are:
- you get the best recommendation for each combination of parameters (country, groups, protocol).
- can select openvpn or nordlynx protocol
- use of nordVpn app features (Killswitch, cybersec, ....)


please note, that to avoid dns problem when the dns service is on the same host, /etc/resolv.conf is set to google DNS (1.1.1.1).
That DNS is used only during startup (check latest nordvpn version), NordVpn dns are set when vpn is up.
```
# Generated by NordVPN
nameserver 103.86.96.100
nameserver 103.86.99.100
```


## Usage

The container may use environment variable to select a server, otherwise the best recommended server is selected:
see environment variables to get all available options or [nordVpn support](https://support.nordvpn.com/Connectivity/Linux/1325531132/Installing-and-using-NordVPN-on-Debian-Ubuntu-Raspberry-Pi-Elementary-OS-and-Linux-Mint.htm#Settings).

adding 
``` docker
sysclts:
 - net.ipv6.conf.all.disable_ipv6=1 # disable ipv6
 ```
  might be needed, if nordvpn cannot change the settings itself.

* TECHNOLOGY=[NordLynx]/[OpenVPN], default: NordLynx (wireguard like)
* CONNECT = [country]/[server]/[country_code]/[city] or [country] [city], if none provide you will connect to the recommended server.
* [COUNTRY](https://api.nordvpn.com/v1/servers/countries) define the exit country.
* [GROUP](https://api.nordvpn.com/v1/servers/groups): Africa_The_Middle_East_And_India, Asia_Pacific, Europe, Onion_Over_VPN, P2P, Standard_VPN_Servers, The_Americas, although many categories are possible, p2p seems more adapted.
* NORDVPN_LOGIN=email or token(As of 21/07/25, Service credentials are not allowed.)
* NORDVPN_PASS=pass or empty when using token
* CYBER_SEC, default off
* KILLERSWITCH, default on
* DNS: change dns
* PORTS: add ports to allow
* LOCAL_NETWORK: add subnet to allow, multiple values possible net1, net2, net3, ....
* DOCKER_NET: optional, docker CIDR extracted from container ip if not set. 

### Authentification

As of 22/12/23, login with username and password are deprecated, as well as legacy. username and password login are allowed in the container, may not be allowed by nordvpn.
token login is recommended.

### docker-compose with env variables explained

```yaml
version: '3.8'
services:
  proxy:
    image: edgd1er/nordlynx-proxy:latest
    restart: unless-stopped
    ports:
      - "1080:1080"
      - "8888:8888"
    sysctls:
      - net.ipv6.conf.all.disable_ipv6=1 # disable ipv6
    cap_add:
      - NET_ADMIN               # Required
    environment:
      - TZ=America/Chicago
      #- CONNECT= #Optionnal, override COUNTRY, specify country+serveur number like uk715
      - COUNTRY=de #Optional, by default, servers in user's coyntry.
      - GROUP=P2P #Africa_The_Middle_East_And_India, Asia_Pacific, Europe, Onion_Over_VPN, P2P, Standard_VPN_Servers, The_Americas
      #- KILLERSWITCH=on #Optional, on by default, kill Switch is a feature helping you prevent unprotected access to the internet when your traffic doesn't go through a NordVPN server.
      #- CYBER_SEC=off #CyberSec is a feature protecting you from ads, unsafe connections, and malicious sites
      #- TECHNOLOGY=NordLynx #openvpn or nordlynx
      #- IPV6=off #optional, off by default, on/off available, off disable IPV6 in nordvpn app
      #- NORDVPN_LOGIN=<email|token> #Not required if using secrets
      #- NORDVPN_PASS=<pass> #Not required if using secrets
      #- DEBUG=0 #(0/1) activate debug mode for scripts, dante, tinproxy
      #- LOCAL_NETWORK=192.168.53.0/24 #LAN to route through proxies and vpn.
      #- TINYLOGLEVEL=error #Optional, default error: Critical (least verbose), Error, Warning, Notice, Connect (to log connections without Info's noise), Info
      #- TINYPORT=8888 #define tinyport inside the container, optional, 8888 by default,
      #- DANTE_LOGLEVEL="error" #Optional, error by default, available values: connect disconnect error data
      - DANTE_ERRORLOG=/dev/stdout #Optional, /dev/null by default
        #- DANTE_DEBUG=0 # Optional, 0-9
        #- GENERATE_WIREGUARD_CONF=true #write /etc/wireguard/wg0.conf if true
    secrets:
      - NORDVPN_CREDS

secrets:
    NORDVPN_CREDS:
        file: ./nordvpn_creds #file with username/token in 1st line, passwd in 2nd line.
```

### Troubleshoot

Enter the container: `docker compose exec lynx bash`
Several aliases are available:
* checkhttp: get external ip through http proxy and vpn. should be the same as `checkip`
* checksocks: get external ip through socks proxy and vpn. should be the same as `checkip`
* checkip: get external ip. should be the same as `getcheck`
* checkvpn: print protection status as seen by nordvpn's client.
* getcheck: get information as ip from nordvpn client.
* getdante: print socks proxy configuration
* gettiny: print http proxy configuration

```bash
root@723b24ebe363:/app# alias
alias checkhttp='curl -sm 10 -x http://${HOSTNAME}:${WEBPROXY_PORT:-8888} "https://ifconfig.me/ip";echo'
alias checkip='curl -sm 10 "https://zx2c4.com/ip";echo'
alias checksocks='curl -sm10 -x socks5://${HOSTNAME}:1080 "https://ifconfig.me/ip";echo'
alias checkvpn='curl -sm 10 "https://api.nordvpn.com/vpn/check/full" | jq -r .status'
alias getcheck='curl -sm 10 "https://api.nordvpn.com/vpn/check/full" | jq . '
alias getdante='grep -vP "(^$|^#)" /etc/dante.conf'
alias gettiny='grep -vP "(^$|^#)" /etc/tinyproxy/tinyproxy.conf'
```
